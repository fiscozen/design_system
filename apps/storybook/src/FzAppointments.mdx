import { Meta } from '@storybook/addon-docs/blocks'

<Meta title="Documentation/Form/FzAppointments" />

# FzAppointments

A comprehensive appointment booking component that allows users to select a date and time slot from available appointments. Supports two modes: **automatic slot generation** or **predefined slots**.

## Features

- **Two Modes**: Automatic slot generation or predefined slots
- **Date Navigation**: Navigate between dates with forward/backward buttons
- **Flexible Slot Configuration**: Customizable start time, count, interval, and break duration (auto mode)
- **Pre-defined Slots**: Pass specific date-time slots grouped automatically by day (manual mode)
- **Day Exclusion**: Exclude specific dates, holidays, or days of the week
- **Slot Management**: Disable individual time slots that are already booked
- **Date Validation**: Automatic validation for past dates and maximum date limits
- **Empty State**: Shows alert when no slots are available
- **Accessibility**: Full keyboard navigation and ARIA support

## Installation

```bash
npm install @fiscozen/appointments
```

## Modes

FzAppointments supports two distinct usage modes:

<table>
  <thead>
    <tr>
      <th>Mode</th>
      <th>Description</th>
      <th>Use Case</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Auto</td>
      <td>Component generates slots automatically based on configuration</td>
      <td>When you have regular time slots (e.g., every 30 minutes from 9:00 to 18:00)</td>
    </tr>
    <tr>
      <td>Manual</td>
      <td>You provide specific date-time slots</td>
      <td>When slots come from an API or have irregular availability</td>
    </tr>
  </tbody>
</table>

## Auto Mode (Automatic Slot Generation)

In this mode, the component automatically generates time slots based on the provided configuration. Use this when you have regular, repeating time slots.

### Basic Usage

```vue
<script setup lang="ts">
import { ref } from 'vue'
import { FzAppointments } from '@fiscozen/appointments'
import { formatISO } from 'date-fns'

const selectedAppointment = ref<string | undefined>()
const startDate = formatISO(new Date())
const slotStartTime = formatISO(new Date().setHours(9, 0, 0, 0))
</script>

<template>
  <FzAppointments
    v-model="selectedAppointment"
    :start-date="startDate"
    :slot-start-time="slotStartTime"
    :slot-count="8"
    :slot-interval="30"
    type="auto"
  />
</template>
```

### Props (Auto Mode)

<table>
  <thead>
    <tr>
      <th>Prop</th>
      <th>Type</th>
      <th>Default</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        <code>slotCount</code>
      </td>
      <td>
        <code>number</code>
      </td>
      <td>-</td>
      <td>
        <strong>Required.</strong> Number of time slots to create.
      </td>
    </tr>
    <tr>
      <td>
        <code>slotStartTime</code>
      </td>
      <td>
        <code>string</code>
      </td>
      <td>
        <code>"09:00"</code>
      </td>
      <td>Start time for slots as ISO-8601 string. The date part is ignored.</td>
    </tr>
    <tr>
      <td>
        <code>slotInterval</code>
      </td>
      <td>
        <code>number</code>
      </td>
      <td>
        <code>30</code>
      </td>
      <td>Interval between slots in minutes.</td>
    </tr>
    <tr>
      <td>
        <code>breakDuration</code>
      </td>
      <td>
        <code>number</code>
      </td>
      <td>
        <code>0</code>
      </td>
      <td>Break duration between slots in minutes.</td>
    </tr>
    <tr>
      <td>
        <code>startDate</code>
      </td>
      <td>
        <code>string</code>
      </td>
      <td>Today</td>
      <td>Start date as ISO-8601 string. Users cannot navigate before this date.</td>
    </tr>
    <tr>
      <td>
        <code>maxDate</code>
      </td>
      <td>
        <code>string</code>
      </td>
      <td>
        <code>undefined</code>
      </td>
      <td>Maximum date as ISO-8601 string. Users cannot navigate after this date.</td>
    </tr>
    <tr>
      <td>
        <code>excludedDays</code>
      </td>
      <td>
        <code>(Date | string | number)[]</code>
      </td>
      <td>
        <code>[]</code>
      </td>
      <td>
        Days to exclude. See <a href="#excluded-days">Excluded Days</a> section.
      </td>
    </tr>
    <tr>
      <td>
        <code>excludedSlots</code>
      </td>
      <td>
        <code>(Date | string)[]</code>
      </td>
      <td>
        <code>[]</code>
      </td>
      <td>Specific slots to disable (already booked).</td>
    </tr>
  </tbody>
</table>

### Slot Calculation Examples

```vue
<!-- 8 slots starting at 09:00, 30 minutes apart -->
<!-- Result: 09:00, 09:30, 10:00, 10:30, 11:00, 11:30, 12:00, 12:30 -->
<FzAppointments
  :slot-start-time="formatISO(new Date().setHours(9, 0, 0, 0))"
  :slot-count="8"
  :slot-interval="30"
  type="auto"
/>

<!-- 3 slots with 10-minute breaks starting at 11:00 -->
<!-- Result: 11:00, 11:40, 12:20 -->
<FzAppointments
  :slot-start-time="formatISO(new Date().setHours(11, 0, 0, 0))"
  :slot-count="3"
  :slot-interval="30"
  :break-duration="10"
  type="auto"
/>
```

---

## Manual Mode (Predefined Slots)

In this mode, you provide a specific list of date-time slots. Use this when slots come from an API, have irregular availability, or span multiple days with different times.

### Basic Usage

```vue
<script setup lang="ts">
import { ref } from 'vue'
import { FzAppointments } from '@fiscozen/appointments'

const selectedAppointment = ref<string | undefined>()

// Define specific slots - can be on different days with different times
const slots = [
  new Date('2024-01-15T09:00:00'),
  new Date('2024-01-15T10:30:00'),
  new Date('2024-01-15T14:00:00'),
  new Date('2024-01-16T11:00:00'),
  new Date('2024-01-16T15:30:00')
]
</script>

<template>
  <FzAppointments v-model="selectedAppointment" :slots="slots" type="manual" />
</template>
```

### How It Works

When using `slots` prop:

- Slots are **automatically grouped by day**
- Navigation only allows moving between days that have available slots
- Each day shows only the slots defined for that specific day

**Example:**

```typescript
const slots = [
  new Date('2024-01-15T09:00:00'), // Day 1: 09:00
  new Date('2024-01-15T10:30:00'), // Day 1: 10:30
  new Date('2024-01-16T14:00:00') // Day 2: 14:00
]
```

- **January 15**: Shows 09:00 and 10:30
- **January 16**: Shows 14:00
- Navigation arrows only allow switching between these two days

### Props (Manual Mode)

<table>
  <thead>
    <tr>
      <th>Prop</th>
      <th>Type</th>
      <th>Default</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        <code>slots</code>
      </td>
      <td>
        <code>(Date | string)[]</code>
      </td>
      <td>-</td>
      <td>
        <strong>Required.</strong> Array of date-time slots as Date objects or ISO-8601 strings.
      </td>
    </tr>
    <tr>
      <td>
        <code>infoText</code>
      </td>
      <td>
        <code>string</code>
      </td>
      <td>
        <code>undefined</code>
      </td>
      <td>Custom info text to display. If not provided, info text is hidden.</td>
    </tr>
  </tbody>
</table>

### Fetching Slots from API

```vue
<script setup lang="ts">
import { ref, onMounted } from 'vue'
import { FzAppointments } from '@fiscozen/appointments'

const selectedAppointment = ref<string | undefined>()
const availableSlots = ref<Date[]>([])

onMounted(async () => {
  const response = await fetch('/api/available-slots')
  const data = await response.json()
  // API returns ISO strings, component accepts both Date and string
  availableSlots.value = data.slots
})
</script>

<template>
  <FzAppointments
    v-model="selectedAppointment"
    :slots="availableSlots"
    info-text="Seleziona un orario per la tua consulenza"
    type="manual"
  />
</template>
```

---

## Common Props (Both Modes)

These props are available in both Auto and Manual modes:

<table>
  <thead>
    <tr>
      <th>Prop</th>
      <th>Type</th>
      <th>Default</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        <code>type</code>
      </td>
      <td>
        <code>"auto" | "manual"</code>
      </td>
      <td>
        <code>"auto"</code>
      </td>
      <td>The type of appointments component to use.</td>
    </tr>
    <tr>
      <td>
        <code>modelValue</code>
      </td>
      <td>
        <code>string | undefined</code>
      </td>
      <td>
        <code>undefined</code>
      </td>
      <td>The selected date and time (v-model) as ISO-8601 string.</td>
    </tr>
    <tr>
      <td>
        <code>name</code>
      </td>
      <td>
        <code>string</code>
      </td>
      <td>
        <code>"fz-appointments"</code>
      </td>
      <td>Name for the radio group. Used for form submission.</td>
    </tr>
    <tr>
      <td>
        <code>required</code>
      </td>
      <td>
        <code>boolean</code>
      </td>
      <td>
        <code>false</code>
      </td>
      <td>Whether the selection is required for form validation.</td>
    </tr>
    <tr>
      <td>
        <code>infoText</code>
      </td>
      <td>
        <code>string</code>
      </td>
      <td>Auto-generated or hidden</td>
      <td>
        Custom info text. In Auto mode, defaults to showing interval. In Manual mode, hidden unless
        provided.
      </td>
    </tr>
    <tr>
      <td>
        <code>alertTitle</code>
      </td>
      <td>
        <code>string</code>
      </td>
      <td>
        <code>"Nessuna disponibilit√†"</code>
      </td>
      <td>Title for the alert shown when no slots are available.</td>
    </tr>
    <tr>
      <td>
        <code>alertDescription</code>
      </td>
      <td>
        <code>string</code>
      </td>
      <td>
        <code>"Scegli un'altro giorno..."</code>
      </td>
      <td>Description text for the alert shown when no slots are available.</td>
    </tr>
  </tbody>
</table>

---

## Excluded Days (Auto Mode Only)

The `excludedDays` prop accepts an array that can contain three different types of values:

### 1. Day of Week Numbers

Exclude specific days of the week (0 = Sunday, 6 = Saturday):

```vue
<script setup>
// Exclude weekends
const excludedDays = [0, 6]
</script>

<template>
  <FzAppointments :excluded-days="excludedDays" :slot-count="8" type="auto" />
</template>
```

### 2. ISO String Dates

```vue
<script setup>
const holidays = [
  '2024-12-25', // Christmas
  '2024-01-01' // New Year
]
</script>

<template>
  <FzAppointments :excluded-days="holidays" :slot-count="8" type="auto" />
</template>
```

### 3. Date Objects

```vue
<script setup>
const holidays = [new Date('2024-12-25'), new Date('2024-01-01')]
</script>

<template>
  <FzAppointments :excluded-days="holidays" :slot-count="8" type="auto" />
</template>
```

### Mixed Usage

```vue
<script setup>
const excludedDays = [
  0,
  6, // Exclude weekends (every week)
  '2024-12-25', // Christmas (specific date)
  new Date('2024-01-01') // New Year (specific date)
]
</script>
```

---

## Behavior

### Date Navigation

- Users can navigate forward/backward using the arrow buttons
- **Auto Mode**: Navigates between consecutive days (skipping excluded days)
- **Manual Mode**: Navigates only between days that have available slots
- The selected slot is reset when changing dates

### Empty State

When no slots are available for the current date, the component shows an `FzAlert` with the configured title and description.

### Value Management

- The `modelValue` is an ISO-8601 string containing both date and time
- When a slot is selected, the ISO string is emitted via `update:modelValue`
- When the date changes, the selection is automatically reset to `undefined`

---

## Accessibility

- **Keyboard Navigation**: Full support for Tab navigation between slots
- **Screen Readers**: Proper ARIA labels and role attributes
- **Focus Management**: Clear focus indicators on interactive elements
- **Semantic HTML**: Uses native radio inputs for proper form behavior
- **Button Labels**: Navigation buttons have descriptive aria-labels ("Giorno precedente", "Giorno successivo")

---

## Related Components

- **FzRadioCard**: Used internally to display time slots
- **FzRadioGroup**: Groups the time slot radio buttons
- **FzIconButton**: Navigation buttons for date selection
- **FzAlert**: Shown when no slots are available
